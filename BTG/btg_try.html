<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Brands To Go | Careers</title>
  <style>
    body { font-family: Arial, sans-serif; max-width: 560px; margin: 40px auto; padding: 0 16px; }
    input, select, button { width: 100%; padding: 12px; margin: 10px 0; }
    button { background: #EF3340; color: white; border: none; cursor: pointer; font-weight: 700; }
    #msg { font-weight: 700; text-align: center; margin-top: 12px; }
  </style>
</head>
<body>

  <h2>Apply Now</h2>

  <form onsubmit="event.preventDefault(); submitForm(this);">
    <input name="name" placeholder="Full Name" required />
    <input name="email" type="email" placeholder="Email" required />
    <input name="phone" placeholder="Phone" required />

    <select name="mall_pref">
      <option>Reem Mall</option>
      <option>Al Wahda Mall</option>
    </select>

    <input name="applied_role" placeholder="Role Applying For" required />

    <input id="cv" type="file" accept="application/pdf" required />

    <button id="btn" type="submit">Submit</button>
  </form>

  <div id="msg"></div>

<script>
function submitForm(form) {
  const msg = document.getElementById("msg");
  const btn = document.getElementById("btn");
  const file = document.getElementById("cv").files[0];

  btn.disabled = true;
  btn.innerText = "Uploading...";
  msg.textContent = "";

  if (!file || file.type !== "application/pdf") {
    msg.style.color = "red";
    msg.textContent = "❌ Please upload a PDF CV.";
    btn.disabled = false;
    btn.innerText = "Submit";
    return;
  }

  const reader = new FileReader();
  reader.onload = () => {
    const payload = {
      name: form.name.value.trim(),
      email: form.email.value.trim(),
      phone: form.phone.value.trim(),
      mall_pref: form.mall_pref.value,
      applied_role: form.applied_role.value.trim(),
      cv_filename: file.name,
      cv_base64: String(reader.result).split(",")[1]
    };

    google.script.run
      .withSuccessHandler((res) => {
        msg.style.color = "green";
        msg.textContent = "✅ Application submitted successfully!";
        form.reset();
        btn.disabled = false;
        btn.innerText = "Submit";
      })
      .withFailureHandler((err) => {
        msg.style.color = "red";
        msg.textContent = "❌ " + (err.message || err);
        btn.disabled = false;
        btn.innerText = "Submit";
      })
      .submitApplication(payload);
  };

  reader.onerror = () => {
    msg.style.color = "red";
    msg.textContent = "❌ File read failed.";
    btn.disabled = false;
    btn.innerText = "Submit";
  };

  reader.readAsDataURL(file);
}
</script>

</body>
</html>
